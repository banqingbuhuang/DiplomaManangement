<!DOCTYPE html>
<!--
This is a starter template page. Use this page to start your new project from
scratch. This page gets rid of all links and provides the needed markup only.
-->
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=chrome">
    <title>
        <%= title %>
    </title>
    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="bower_components/font-awesome/css/font-awesome.min.css">
    <!-- Ionicons -->
    <link rel="stylesheet" href="bower_components/Ionicons/css/ionicons.min.css">
    <link rel="stylesheet" href="bower_components/morris.js/morris.css">

    <link rel="stylesheet" href="bower_components/datatables.net-bs/css/dataTables.bootstrap.min.css">
    <!-- Theme style -->
    <link rel="stylesheet" href="dist/css/AdminLTE.min.css">
    <!-- AdminLTE Skins. We have chosen the skin-blue for this starter
          page. However, you can choose any other skin. Make sure you
          apply the skin class to the body tag so the changes take effect. -->
    <link rel="stylesheet" href="dist/css/skins/skin-blue.min.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->

    <!-- Google Font -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic">

    <style>
        .msg{
            display: none;
            color: red;
            font-weight: normal;
            
        };
    </style>
</head>

<body class="hold-transition skin-blue sidebar-mini">
    <div class="wrapper">

        <!-- Main Header -->
        <header class="main-header">

            <!-- Logo -->
            <a href="/total" class="logo">
                <!-- mini logo for sidebar mini 50x50 pixels -->
                <span class="logo-mini">
                    <b>F</b>NC</span>
                <!-- logo for regular state and mobile devices -->
                <span class="logo-lg">
                    <b>证书认证系统</b>
                </span>
            </a>

            <!-- Header Navbar -->
            <nav class="navbar navbar-static-top" role="navigation">
                <!-- Sidebar toggle button-->
                <a href="#" class="sidebar-toggle" data-toggle="push-menu" role="button">
                    <span class="sr-only">Toggle navigation</span>
                </a>
                <!-- Navbar Right Menu -->
                <div class="navbar-custom-menu">
                    <ul class="nav navbar-nav">
                        <!-- User Account Menu -->
                        <li class="dropdown user user-menu">
                            <!-- Menu Toggle Button -->
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                <!-- The user image in the navbar-->
                                <img src="dist/img/user2-160x160.jpg" class="user-image" alt="User Image">
                                <!-- hidden-xs hides the username on small devices so only the image appears. -->
                                <span class="hidden-xs">
                                    <%=username%>
                                </span>
                            </a>
                            <ul class="dropdown-menu">
                                <!-- The user image in the menu -->
                                <li class="user-header">
                                    <img src="dist/img/user2-160x160.jpg" class="img-circle" alt="User Image">
                                    <p>
                                        <%=username%>
                                            <!--<small>Member since Nov. 2012</small>-->
                                    </p>
                                </li>
                                <!-- Menu Body -->
                                <li class="user-body">
                                    <!-- /.row -->
                                </li>
                                <!-- Menu Footer-->
                                <li class="user-footer">
                                    <div class="pull-right-container">
                                        <a href="/logout" class="btn btn-default btn-flat" style="float: right;">退出</a>
                                    </div>
                                </li>
                            </ul>
                        </li>
                        <!-- Control Sidebar Toggle Button -->
                    </ul>
                </div>
            </nav>
        </header>
        <!-- Left side column. contains the logo and sidebar -->
        <aside class="main-sidebar">

            <!-- sidebar: style can be found in sidebar.less -->
            <section class="sidebar">

                <!-- Sidebar user panel (optional) -->
                <div class="user-panel">
                    <div class="pull-left image">
                        <img src="dist/img/user2-160x160.jpg" class="img-circle" alt="User Image">
                    </div>
                    <div class="pull-left info">
                        <p>
                            <%=username%>
                        </p>
                        <!-- Status -->
                        <a href="#">
                            <i class="fa fa-circle text-success"></i> 用户</a>
                    </div>
                </div>

                <!-- Sidebar Menu -->
                <ul class="sidebar-menu" data-widget="tree">
                    <li class="header">目 录</li>
                    <!-- Optionally, you can add icons to the links -->
                    <li><a href="/conductor"><i class="fa fa-link"></i><span>主界面</span></a></li>
                    <li class="treeview active">
                        <a href="#">
                            <i class="fa fa-link"></i><span>单个操作</span>
                            <span class="pull-right-container"><i class="fa fa-angle-left pull-right"></i></span>
                        </a>
                        <ul class="treeview-menu">
                            <li><a href="/oneinput">单个录入</a></li>
                            <li class="active"><a href="/onemodify">单个修改</a></li>
                        </ul>
                    </li>
                    <li ><a href="/excel"><i class="fa fa-link"></i><span>批量录入</span></a></li>
                    <li><a href="/count"><i class="fa fa-link"></i><span>模糊查询</span></a></li>
                    <li><a href="/revoke"><i class="fa fa-link"></i><span>撤销</span></a></li>
                    <li><a href="/sample"><i class="fa fa-link"></i><span>样本</span></a></li>
                </ul>
                <!-- /.sidebar-menu -->
            </section>
            <!-- /.sidebar -->
        </aside>

        <!-- Content Wrapper. Contains page content -->
        <div class="content-wrapper">
            <!-- Content Header (Page header) -->
            <section class="content-header">
                <h1>
                    单个修改
                    <small>修改信息错误的证书</small>
                </h1>
                <ol class="breadcrumb">
                    <li>
                        <a href="#">
                            <i class="fa fa-dashboard"></i> 主页</a>
                    </li>
                    <li>单个操作</li>
                    <li class="active">单个修改</li>
                </ol>
            </section>

            <!-- Main content -->
            <section class="content">
                <div class="row">
                    <div class="col-md-12 col-xs-12">
                        <div class="box">
                            <div class="box-header">
                                <h3 class="box-title">单个修改</h3>
                                <div class="col-xs-2" style="float: right">
                                    <button type="button" id="search" class="btn btn-block btn-primary">查询</button>
                                </div>
                                <div class="col-xs-3" style="float: right">
                                    <input type="text" name="num" class="form-control" id="num" placeholder="请输入证书编号">
                                </div>
                                <div class="col-xs-2" style="float: right">
                                    <select id="Txtype" name="Txtype" class="btn btn-block btn-default">
                                        <option value="XWZ">学位证书</option>
                                        <option value="BYZ" selected="selected">学历证书</option>
                                    </select>
                                </div>
                            </div>
                            <!-- /.box-header -->
                            <div class="box-body">
                               <table class="table" style="border-top: none">
                                   <tbody id="XWZ_body" style="display: none">
                                       <tr>
                                            <td style="text-align: right"><label for="num">证书编号：</label></td>
                                            <td>
                                               <input type="text" class="form-control num">
                                               <label for="msg" class="msg">请输入16位的证书编号</label>
                                            </td>
                                           <td style="text-align: right"><label for="txtype">层　　次：</label></td>
                                           <td>
                                                <select class="btn btn-default txtype">
                                                    <option value="学士学位证书">学士学位</option>
                                                    <option value="硕士学位证书">硕士学位</option>
                                                    <option value="博士学位证书">博士学位</option>
                                                </select>
                                           </td>
                                       </tr>
                                       <tr>
                                            <td style="text-align: right"><label for="degree">学　　位：</label></td>
                                            <td>
                                                <select class="btn btn-default" id="degree" >
                                                    <option value="工学">工学</option>
                                                    <option value="理学">理学</option>
                                                    <option value="经济学">经济学</option>
                                                    <option value="哲学">哲学</option>
                                                    <option value="法学">法学</option>
                                                    <option value="教育学">教育学</option>
                                                    <option value="文学">文学</option>
                                                    <option value="历史学">历史学</option>
                                                    <option value="农学">农学</option>
                                                    <option value="医学">医学</option>
                                                    <option value="军事学">军事学</option>
                                                    <option value="管理学">管理学</option>
                                                    <option value="艺术学">艺术学</option>
                                                </select>
                                            </td>
                                            <td style="text-align: right"><label for="school">学　　校：</label></td>
                                            <td>
                                                <input type="text" class="form-control school">
                                                <label for="msg" class="msg">学校不能为空</label>
                                            </td>
                                        </tr>
                                       <tr>
                                            <td style="text-align: right"><label for="certdate">发证日期：</label></td>
                                            <td>
                                                <input type="date" class="form-control certdate">
                                                <label for="msg" class="msg">请输入正确的发证日期</label>
                                            </td>
                                            <td style="text-align: right"><label for="name">姓　　名：</label></td>
                                            <td>
                                                <input type="text" class="form-control name">
                                                <label for="msg" class="msg">姓名不能为空</label>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="text-align: right"><label for="sex">性　　别：</label></td>
                                            <td>
                                                <select class="btn btn-default sex">
                                                    <option value="男">男</option>
                                                    <option value="女">女</option>
                                                </select>
                                            </td>
                                            <td style="text-align: right"><label for="birthday">出生日期：</label></td>
                                            <td>
                                                <input type="date" class="form-control birthday">
                                                <label for="msg" class="msg">请输入正确的出生日期</label>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="text-align: right"><label for="major">专　　业：</label></td>
                                            <td>
                                                <input type="text" class="form-control major">
                                                <label for="msg" class="msg">专业不能为空</label>
                                            </td>
                                            <td style="text-align: right"><label for="status">证书状态：</label></td>
                                            <td><input type="text" class="form-control status"></td>
                                        </tr>
                                        <tr>
                                            <td style="text-align: right"><label for="reason">撤销原因：</label></td>
                                            <td colspan="3"><input type="text" class="form-control reason"></input>
                                        </tr>

                                   </tbody>
                                   <tbody id="BYZ_body" style="display: none">
                                        <tr>
                                            <td style="text-align: right"><label for="num">证书编号：</label></td>
                                            <td>
                                                <input type="text" class="form-control num">
                                                <label for="msg" class="msg">请输入18位的证书编号</label>
                                                </input>
                                            </td>
                                            <td style="text-align: right"><label for="txtype">证书类别：</label></td>
                                            <td><input type="text" class="form-control txtype" value="毕业证书" disabled="disabled"></td>
                                        </tr>
                                        <tr>
                                            <td style="text-align: right"><label for="schoolsystem">学　　制：</label></td>
                                            <td>
                                                <select class="btn btn-default" id="schoolsystem" name="schoolsystem">
                                                    <option value="4">4</option>
                                                    <option value="3">3</option>
                                                </select>
                                            </td>
                                            <td style="text-align: right"><label for="school">学　　校：</label></td>
                                            <td>
                                                <input type="text" class="form-control school">
                                                <label for="msg" class="msg">学校不能为空</label>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="text-align: right"><label for="certdate">发证日期：</label></td>
                                            <td>
                                                <input type="date" class="form-control certdate">
                                                <label for="msg" class="msg">请输入正确的发证日期</label>
                                            </td>
                                            <td style="text-align: right"><label for="name">姓　　名：</label></td>
                                            <td>
                                                <input type="text" class="form-control name">
                                                <label for="msg" class="msg">姓名不能为空</label>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="text-align: right"><label for="sex">性　　别：</label></td>
                                            <td>
                                                <select class="btn btn-default sex">
                                                    <option value="男">男</option>
                                                    <option value="女">女</option>
                                                </select>
                                            </td>
                                            <td style="text-align: right"><label for="birthday">出生日期：</label></td>
                                            <td>
                                                <input type="date" class="form-control birthday">
                                                <label for="msg" class="msg">请输入正确的出生日期</label>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="text-align: right"><label for="begin">入学日期：</label></td>
                                            <td>
                                                <input type="date" class="form-control" id="begin">
                                                <label for="msg" class="msg">请输入正确的入学日期</label>
                                            </td>
                                            <td style="text-align: right"><label for="end">毕业日期：</label></td>
                                            <td>
                                                <input type="date" class="form-control" id="end">
                                                <label for="msg" class="msg">请输入正确的毕业日期</label>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="text-align: right"><label for="major">专　　业：</label></td>
                                            <td>
                                                <input type="text" class="form-control major">
                                                <label for="msg" class="msg">专业不能为空</label>
                                            </td>
                                            <td style="text-align: right"><label for="level">层　　次：</label></td>
                                            <td>
                                                <select class="btn btn-default" id="level" name="level">
                                                    <option value="本科">本科</option>
                                                    <option value="大专">大专</option>
                                                    <option value="硕士">硕士</option>
                                                    <option value="博士">博士</option>
                                                </select>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="text-align: right"><label for="form">学习形式：</label></td>
                                            <td>
                                                <select class="btn btn-default" id="form" name="form">
                                                    <option value="普通全日制">普通全日制</option>
                                                    <option value="非全日制">非全日制</option>
                                                </select>
                                            </td>
                                            <td style="text-align: right"><label for="class">学历类别：</label></td>
                                            <td>
                                                <input type="text" class="form-control" id="class">
                                                <label for="msg" class="msg">学历类别不能为空</label>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="text-align: right"><label for="status">证书状态：</label></td>
                                            <td><input type="text" class="form-control status"></td>
                                        </tr>
                                        <tr>
                                            <td style="text-align: right"><label for="reason">撤销原因：</label></td>
                                            <td colspan="3"><input type="text" class="form-control reason"></td>
                                        </tr>
                                   </tbody>
                               </table>
                            </div>
                            <div class="box-footer" id="Btn"  style="display: none">
                                <button type="button" id="modify" class="btn btn-info pull-right">修改</button>
                                <button type="button" id="cancel" class="btn btn-default pull-right" style="margin-right: 40px;">取消</button>     
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
        <!-- /.content-wrapper -->

        <!-- Main Footer -->
        <footer class="main-footer">
            <!-- To the right -->
            <div class="pull-right hidden-xs">
                Anything you want
            </div>
            <!-- Default to the left -->
            <strong>Copyright &copy; 2018
                <a href="#">TheRang</a>.</strong> All rights reserved.
        </footer>
    </div>
    <!-- ./wrapper -->

    <!-- REQUIRED JS SCRIPTS -->

    <script src="bower_components/jquery/dist/jquery.min.js"></script>
    <!-- Bootstrap 3.3.7 -->
    <script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
    <!-- DataTables -->
    <script src="bower_components/datatables.net/js/jquery.dataTables.min.js"></script>
    <script src="bower_components/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
    <!-- SlimScroll -->
    <script src="bower_components/jquery-slimscroll/jquery.slimscroll.min.js"></script>
    <!-- FastClick -->
    <script src="bower_components/fastclick/lib/fastclick.js"></script>
    <!-- AdminLTE App -->
    <script src="dist/js/adminlte.min.js"></script>
    <!-- AdminLTE for demo purposes -->
    <script src="bower_components/raphael/raphael.min.js"></script>
    <script src="bower_components/morris.js/morris.min.js"></script>
    <script src="dist/js/demo.js"></script>
    <script src="dist/js/xlsx.core.min.js"></script>
    <script>
        $('#search').click(function(){
            let Txtype = $('#Txtype').val();
            let num = $('#num').val();
            let key = Txtype + num;
            let cmd = 'query("get","' + key + '")';
            console.log(cmd);
            $.ajax({
                url: '/api',
                type: 'post',
                data: {
                    cmd:cmd
                },
                success: function (data) {
                    data = eval('(' + data + ')');
                    console.log(data)
                    if(data){
                        $('#Btn').show();
                        data = JSON.parse(data);
                        console.log(data);
                        // console.log(data.num);
                        $('.num').val(data.num);
                        $('.txtype').val(data.txtype);
                        $('.school').val(data.school);
                        $('.certdate').val(data.certdate);
                        $('.name').val(data.name);
                        $(".sex").val(data.sex);
                        $(".birthday").val(data.birthday);
                        $(".major").val(data.major);
                        //毕业证
                        if(Txtype == "BYZ"){
                            $('#begin').val(data.begin);
                            $('#end').val(data.end);
                            $('#level').val(data.level);
                            $('#class').val(data.class);
                            $('#form').val(data.form);
                            $("#schoolsystem").val(data.schoolsystem);
                            $('#BYZ_body').show();
                            $('#XWZ_body').hide();
                        }else{//学位证
                            $('#degree').val(data.degree);
                            $('#XWZ_body').show();
                            $('#BYZ_body').hide();
                        }
                        if(data.status){
                            $('.status').val(data.status);
                            $('.reason').val(data.reason);
                        }
                            $('.status').attr("disabled",true);
                            $('.reason').attr("disabled",true);
                    }else{
                        alert("查无此证！");
                        $('#BYZ_body').hide();
                        $('#XWZ_body').hide();
                    }
        
                },
                error: function (e) {
                    alert('server error!');
                }
            });
        });

        $('#cancel').click(function(){
            $('#BYZ_body').hide();
            $('#XWZ_body').hide();
            $('#Btn').hide();

        });

        var flag = true;
        // //检查日期正则表达式
        // var regex = new RegExp(
        //     /^(?:(?!0000)[0-9]{4}-(?:(?:0[1-9]|1[0-2])-(?:0[1-9]|1[0-9]|2[0-8])|(?:0[13-9]|1[0-2])-(?:29|30)|(?:0[13578]|1[02])-31)|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)-02-29)$/
        // );
        //失去焦点事件
        $('#BYZ_body .num').blur(function(){
            if($('#BYZ_body .num').val().length != 18){
                flag = false;
                $(this).parent().find($('.msg')).show();
            }else{
                flag = true;
                $(this).parent().find($('.msg')).hide();
            }
            if(!flag){
                $('#modify').attr("disabled",true);
            }else{
                $('#modify').attr("disabled",false);
            }
        })

        $('#XWZ_body .num').blur(function(){
            if($('#XWZ_body .num').val().length != 18){
                flag = false;
                $(this).parent().find($('.msg')).show();
            }else{
                flag = true;
                $(this).parent().find($('.msg')).hide();
            }
            if(!flag){
                $('#modify').attr("disabled",true);
            }else{
                $('#modify').attr("disabled",false);
            }
        })

        $('.school').blur(function(){
            if(!$(this).val()){
                flag = false;
                $(this).parent().find($('.msg')).show();
            }else{
                flag = true;
                $(this).parent().find($('.msg')).hide();
            }
            if(!flag){
                $('#modify').attr("disabled",true);
            }else{
                $('#modify').attr("disabled",false);
            }
        })

        $('.certdate').blur(function(){
            if(!$(this).val()){
                flag = false;
                $(this).parent().find($('.msg')).show();
            }else{
                flag = true;
                $(this).parent().find($('.msg')).hide();
            }
            if(!flag){
                $('#modify').attr("disabled",true);
            }else{
                $('#modify').attr("disabled",false);
            }
        })

        $('.name').blur(function(){
            if(!$(this).val()){
                flag = false;
                $(this).parent().find($('.msg')).show();
            }else{
                flag = true;
                $(this).parent().find($('.msg')).hide();
            }
            if(!flag){
                $('#modify').attr("disabled",true);
            }else{
                $('#modify').attr("disabled",false);
            }
        })

        $('.birthday').blur(function(){
            if(!$(this).val()){
                flag = false;
                $(this).parent().find($('.msg')).show();
            }else{
                flag = true;
                $(this).parent().find($('.msg')).hide();
            }
            if(!flag){
                $('#modify').attr("disabled",true);
            }else{
                $('#modify').attr("disabled",false);
            }
        })

        $('.major').blur(function(){
            if(!$(this).val()){
                flag = false;
                $(this).parent().find($('.msg')).show();
            }else{
                flag = true;
                $(this).parent().find($('.msg')).hide();
            }
            if(!flag){
                $('#modify').attr("disabled",true);
            }else{
                $('#modify').attr("disabled",false);
            }
        })

        $('#begin').blur(function(){
            if(!$(this).val()){
                flag = false;
                $(this).parent().find($('.msg')).show();
            }else{
                flag = true;
                $(this).parent().find($('.msg')).hide();
            }
            if(!flag){
                $('#modify').attr("disabled",true);
            }else{
                $('#modify').attr("disabled",false);
            }
        })

        $('#end').blur(function(){
            if(!$(this).val()){
                flag = false;
                $(this).parent().find($('.msg')).show();
            }else{
                flag = true;
                $(this).parent().find($('.msg')).hide();
            }
            if(!flag){
                $('#modify').attr("disabled",true);
            }else{
                $('#modify').attr("disabled",false);
            }
        })

        $('#class').blur(function(){
            if(!$(this).val()){
                flag = false;
                $(this).parent().find($('.msg')).show();
            }else{
                flag = true;
                $(this).parent().find($('.msg')).hide();
            }
            if(!flag){
                $('#modify').attr("disabled",true);
            }else{
                $('#modify').attr("disabled",false);
            }
        })


        $('#modify').click(function(){
            //毕业证
            if($('#Txtype').val() == "BYZ"){

                var num = $('#BYZ_body .num').val();
                var school = $('#BYZ_body .school').val();
                var certdate = $('#BYZ_body .certdate').val();
                var name = $('#BYZ_body .name').val();
                var sex = $('#BYZ_body .sex').val();
                var birthday = $('#BYZ_body .birthday').val();
                var major = $('#BYZ_body .major').val();
                var txtype = $('#BYZ_body .txtype').val();

                var begin = $('#begin').val();
                var end = $('#end').val();
                var level = $('#level').val();
                var classes = $('#class').val();//用class会报错
                var form = $('#form').val();
                var schoolsystem = $("#schoolsystem").val();
                console.log(sex);
            }else{//学位证

                var num = $('#XWZ_body .num').val();
                var school = $('#XWZ_body .school').val();
                var certdate = $('#XWZ_body .certdate').val();
                var name = $('#XWZ_body .name').val();
                var sex = $('#XWZ_body .sex').val();
                var birthday = $('#XWZ_body .birthday').val();
                var major = $('#XWZ_body .major').val();
                var txtype = $('#XWZ_body .txtype').val();

                var degree = $('#degree').val();
            };

            if($('.status').val()){
                var status = $('.status').val();
                var reason = $('.reason').val();
            }

            var key = $('#Txtype').val() + num;
            var jsonobj = {
                num: num,
                txtype: txtype,
                school: school,
                certdate: certdate,
                name: name,
                sex: sex,
                birthday: birthday,
                end: end,
                major: major,
                begin: begin,
                level: level,
                class: classes,
                form: form,
                schoolsystem: schoolsystem,
                degree:degree,
                status:status,
                reason:reason
            }

            var cmd = 'invoke("put","'+key+'",\''+JSON.stringify(jsonobj)+'\')';
            console.log(cmd);

            $.ajax({
                url: '/api',
                type: 'post',
                data: {
                    cmd:cmd
                },
                success: function (data) {
                    alert("修改成功！");
                },
                error: function (e) {
                    alert('server error!');
                }
            });
        });
    </script>
</body>

</html>